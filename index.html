<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistema OS - Comunica√ß√£o Visual</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --black: #231f20;
            --red: #ed1c24;
            --blue: #00aeef;
            --green: #00a651;
            --gray: #e6e7e8;
            --border-radius: 6px;
        }

        /* RESET GERAL */
        body { 
            font-family: 'Montserrat', sans-serif; 
            margin: 0; padding: 0;
            background: #333; display: flex;
            user-select: none;
            overflow: hidden; 
        }
        
        /* --- PAINEL DE CONTROLE (ESQUERDA) --- */
        #painel-controle { 
            width: 380px; padding: 25px; background: #2c3e50; color: white;
            height: 100vh; overflow-y: auto; box-sizing: border-box; position: fixed;
            border-right: 5px solid #1a252f; z-index: 20;
            transition: transform 0.3s ease;
        }
        
        #painel-controle::-webkit-scrollbar { width: 8px; }
        #painel-controle::-webkit-scrollbar-track { background: #1a252f; }
        #painel-controle::-webkit-scrollbar-thumb { background: #f1c40f; border-radius: 4px; }
        .grupo-input { margin-bottom: 15px; }
        .titulo-secao { color: #f1c40f; font-weight: bold; margin-top: 20px; border-bottom: 1px solid #555; padding-bottom: 5px; margin-bottom: 10px;}
        label { display: block; font-size: 12px; margin-bottom: 5px; color: #bdc3c7; }
        input[type="text"], input[type="date"], input[type="number"], select, textarea { 
            width: 100%; padding: 10px; border-radius: 6px; border: none; 
            box-sizing: border-box; font-family: 'Montserrat', sans-serif; font-weight: bold;
            background: #34495e; color: white;
        }
        textarea { height: 80px; resize: none; }
        .check-group { display: flex; flex-direction: column; gap: 8px; }
        .check-item { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .check-item input { transform: scale(1.2); accent-color: #f1c40f; }

        /* --- √ÅREA DE IMPRESS√ÉO (DIREITA) --- */
        #area-impressao { 
            margin-left: 380px; display: flex; justify-content: center; 
            padding: 40px; width: calc(100% - 380px); 
            background: #555; height: 100vh; overflow-y: auto; box-sizing: border-box;
        }
        
        .folha-a4 {
            width: 210mm; min-height: 296mm; 
            background: white; position: relative; 
            padding: 10mm; box-sizing: border-box;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            display: flex; flex-direction: column;
            transform-origin: top center; 
        }

        /* --- ESTILOS DO CONTE√öDO DA OS --- */
        .header-grid { display: grid; grid-template-columns: 3fr 1fr; gap: 8px; margin-bottom: 5px; }
        .col-esq { display: flex; flex-direction: column; gap: 4px; }
        .col-dir { display: flex; flex-direction: column; border: 2px solid var(--black); border-radius: var(--border-radius); overflow: hidden; }
        .header-top { background: var(--black); color: white; padding: 8px 12px; font-weight: 900; font-size: 22px; text-transform: uppercase; border-radius: var(--border-radius); margin-bottom: 4px; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        .linha-dados { display: flex; border: 1px solid #ddd; border-radius: var(--border-radius); overflow: hidden; height: 32px;}
        .col { padding: 0 10px; border-right: 1px solid #ddd; font-size: 12px; display: flex; align-items: center; height: 100%; }
        .col:last-child { border-right: none; }
        .label-simple { font-weight: 900; margin-right: 5px; color: #555; text-transform: uppercase; font-size: 10px; letter-spacing: 0.5px;}

        /* OS DARK */
        .box-os { background: var(--black); flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-bottom: 2px solid var(--black); -webkit-print-color-adjust: exact; print-color-adjust: exact; padding: 2px; }
        .os-label { font-size: 12px; font-weight: 900; color: white; margin-bottom: 2px;}
        .os-valor-box { background: white; width: 90%; text-align: center; border-radius: 4px; }
        .os-valor { font-size: 24px; font-weight: 900; color: var(--black); line-height: 1.2; }
        .box-logistica { padding: 5px; flex: 1; display: flex; flex-direction: column; justify-content: center; background: white; }
        .log-item { display: flex; align-items: center; margin-bottom: 2px; font-size: 10px; font-weight: bold;}
        .box-check-log { width: 10px; height: 10px; border: 1px solid var(--black); margin-right: 6px; display: flex; align-items: center; justify-content: center; font-size: 8px; color: var(--red); line-height: 10px; border-radius: 50%; }

        .grid-datas-pag { display: grid; grid-template-columns: 1.5fr 1fr 1fr; gap: 4px; height: 45px; }
        .box-pagamento { display: flex; flex-direction: column; justify-content: center; padding-left: 10px; background: #eee; border-radius: var(--border-radius); border: 1px solid #ddd; font-size: 10px; font-weight: 900; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        .pag-valor { font-size: 16px; color: var(--red); }
        .box-data { border: 1px solid #ddd; border-radius: var(--border-radius); display: flex; flex-direction: column; overflow: hidden; }
        .data-header { background: #666; color: white; font-size: 9px; text-align: center; padding: 3px; font-weight: bold; text-transform: uppercase; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        .data-valor { text-align: center; font-weight: 900; color: var(--red); font-size: 14px; display: flex; align-items: center; justify-content: center; height: 100%; }

        .area-status { display: flex; align-items: center; gap: 10px; margin-top: 2px; padding: 5px 0; border-bottom: 2px dotted #ccc; }
        .badges-wrapper { display: flex; gap: 6px; align-items: center; }
        .badge-box { display: flex; width: 60px; height: 26px; border: 1px solid #ccc; border-radius: 13px; overflow: hidden; box-shadow: 1px 1px 0px rgba(0,0,0,0.1); }
        .badge-letra { width: 24px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 900; font-size: 14px; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        .badge-x { flex: 1; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 16px; color: var(--black); background: white; }
        .bg-red { background: var(--red); border-color: var(--red); }
        .bg-blue { background: var(--blue); border-color: var(--blue); }
        .bg-green { background: var(--green); border-color: var(--green); }
        .maq-cartao { margin-left: auto; background: var(--red); color: white; font-weight: 900; font-size: 10px; padding: 4px 8px; display: flex; align-items: center; gap: 6px; height: 20px; border-radius: 4px; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        .box-check-maq { width: 14px; height: 14px; background: white; border-radius: 2px; color: black; text-align: center; line-height: 14px; font-size: 12px; font-weight: 900;}

        .titulo-servico { text-align: center; color: var(--red); font-weight: 900; font-size: 22px; margin: 10px 0 5px 0; text-transform: uppercase; letter-spacing: 1px; }
        
        .area-imagens { flex-grow: 1; border: 2px dashed #ccc; border-radius: var(--border-radius); position: relative; overflow: hidden; margin-bottom: 5px; background-color: #fcfcfc; touch-action: none; }
        .draggable-img { position: absolute; cursor: move; width: 150px; touch-action: none;}
        .img-selected { border: 2px solid var(--blue); box-shadow: 0 0 10px rgba(0, 174, 239, 0.5); z-index: 100; }
        .placeholder-text { font-size: 18px; font-weight: 700; color: #ddd; position: absolute; z-index: 0; text-align: center; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none;}
        .area-desc-titulo { font-weight: 900; font-size: 11px; margin-bottom: 2px; color: #555; text-transform: uppercase;}
        .box-anotacoes { height: 80px; border: 1px solid #ccc; border-radius: var(--border-radius); padding: 8px; font-size: 11px; font-family: 'Montserrat', sans-serif; white-space: pre-wrap; background: #fcfcfc; }

        .btn-print { width:100%; padding: 15px; background: var(--green); color:white; border:none; font-weight:900; cursor:pointer; border-radius:6px; font-size: 16px; margin-top: 10px; box-shadow: 0 4px 0 #007f3d; transition: all 0.2s;}
        .btn-save { width:100%; padding: 15px; background: var(--blue); color:white; border:none; font-weight:900; cursor:pointer; border-radius:6px; font-size: 16px; margin-top: 20px; box-shadow: 0 4px 0 #007db0; transition: all 0.2s;}

        /* --- CONTROLES FLUTUANTES (MOBILE) --- */
        .fab-btn {
            position: fixed; bottom: 20px;
            width: 60px; height: 60px; border-radius: 50%;
            border: none; font-size: 24px; font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 100; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        
        #btn-abrir-previa { right: 20px; background: #f1c40f; color: #2c3e50; display: none; }
        #btn-fechar-previa { right: 20px; background: #e74c3c; color: white; display: none; }
        #btn-imprimir-mobile { right: 90px; background: #00a651; color: white; display: none; }

        /* Slider de Zoom Mobile */
        #mobile-zoom-control {
            display: none; position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(44, 62, 80, 0.95); padding: 20px; box-sizing: border-box;
            z-index: 101; text-align: center; color: white;
            border-top-left-radius: 15px; border-top-right-radius: 15px;
        }
        #mobile-zoom-control label { color: #f1c40f; font-weight: bold; margin-bottom: 10px; display: block;}
        /* Aumentei o max para 1500 para permitir zoom gigante */
        #mobile-zoom-control input[type=range] { width: 100%; }

        /* --- RESPONSIVIDADE MOBILE --- */
        @media (max-width: 768px) {
            body { display: block; overflow: auto; background: #2c3e50; }
            
            #painel-controle { 
                width: 100%; height: auto; position: relative; 
                padding-bottom: 100px;
                background: #2c3e50; z-index: 10;
            }

            #area-impressao {
                display: none; position: fixed; top: 0; left: 0; 
                width: 100%; height: 100vh;
                background: #333; z-index: 50;
                overflow-y: scroll;
                align-items: flex-start; padding: 10px;
            }

            .folha-a4 {
                min-width: 210mm; width: 210mm; 
                min-height: 296mm; height: auto;
                transform-origin: top center;
                margin-top: 10px; margin-bottom: 100px;
            }

            #btn-abrir-previa { display: flex; }
            .btn-print { display: none; }
        }

        @page { size: A4; margin: 0; }
        @media print {
            body { background: white; margin: 0; padding: 0; display: block;}
            #painel-controle, .fab-btn, #mobile-zoom-control { display: none !important; }
            #area-impressao { 
                margin: 0; padding: 0; width: 100%; height: 100vh; 
                background: none; display: block; position: static;
                transform: none; overflow: visible;
            }
            .folha-a4 { 
                box-shadow: none; padding: 10mm; margin: 0 auto; 
                width: 210mm; min-height: 296mm; transform: none !important; 
            }
            .area-imagens { border: 1px dashed #ccc; }
            .placeholder-text { display: none; }
            .img-selected { border: none; box-shadow: none; }
        }
    </style>
</head>
<body>

    <button id="btn-abrir-previa" class="fab-btn" onclick="abrirPrevia()">üëÅÔ∏è</button>
    <button id="btn-fechar-previa" class="fab-btn" onclick="fecharPrevia()">‚úèÔ∏è</button>
    <button id="btn-imprimir-mobile" class="fab-btn" onclick="window.print()">üñ®Ô∏è</button>

    <div id="mobile-zoom-control">
        <label>TAMANHO DA IMAGEM</label>
        <input type="range" id="zoom-slider" min="50" max="1500" value="150" oninput="aplicarZoomMobile(this.value)">
    </div>

    <div id="painel-controle">
        <h2 style="margin-top: 0; color: #f1c40f;">GERADOR DE O.S.</h2>

        <div class="grupo-input">
            <label>NOME DA EMPRESA</label>
            <input type="text" id="in-empresa" placeholder="Ex: Gr√°fica R√°pida" value="SUA EMPRESA AQUI">
        </div>
        <div class="grupo-input">
            <label>NOME DO CLIENTE</label>
            <input type="text" id="in-cliente">
        </div>
        <div class="grupo-input">
            <label>TELEFONE</label>
            <input type="text" id="in-tel" placeholder="(00) 00000-0000">
        </div>
        <div class="grupo-input">
            <label>ENDERE√áO</label>
            <input type="text" id="in-end">
        </div>

        <div style="display: flex; gap: 10px;">
            <div class="grupo-input" style="flex:1;">
                <label>N¬∫ OS</label>
                <input type="text" id="in-os" placeholder="0000">
            </div>
            <div class="grupo-input" style="flex:2;">
                <label>VALOR RESTANTE</label>
                <input type="text" id="in-pag" placeholder="R$ 0,00">
            </div>
        </div>

        <div style="display: flex; gap: 10px;">
            <div class="grupo-input">
                <label>APROVA√á√ÉO</label>
                <input type="text" id="in-data-aprov" placeholder="00/00">
            </div>
            <div class="grupo-input">
                <label>DATA LIMITE</label>
                <input type="text" id="in-data-limite" placeholder="00/00">
            </div>
        </div>

        <div class="check-group">
            <label class="check-item"><input type="checkbox" id="chk-entrada"> ENTRADA (E)</label>
            <label class="check-item"><input type="checkbox" id="chk-faturado"> FATURADO (F)</label>
            <label class="check-item"><input type="checkbox" id="chk-pago"> PAGO (P)</label>
            <label class="check-item"><input type="checkbox" id="chk-maq"> M√ÅQUINA DE CART√ÉO</label>
        </div>

        <div class="titulo-secao">LOG√çSTICA</div>
        <div class="check-group">
            <label class="check-item"><input type="checkbox" id="chk-inst"> INSTALA√á√ÉO</label>
            <label class="check-item"><input type="checkbox" id="chk-ent"> ENTREGA</label>
            <label class="check-item"><input type="checkbox" id="chk-ret"> RETIRADA</label>
        </div>

        <div class="grupo-input">
            <label>T√çTULO DO SERVI√áO</label>
            <input type="text" id="in-servico">
        </div>
        
        <div class="grupo-input">
            <label style="color: #f1c40f; font-weight: bold;">ADICIONAR IMAGENS</label>
            <input type="file" accept="image/*" multiple onchange="adicionarImagens(event)">
        </div>

        <div class="grupo-input" style="margin-top: 15px;">
            <label>DESCRI√á√ÉO / OBS</label>
            <textarea id="in-desc" placeholder="Detalhes..."></textarea>
        </div>

        <button id="btn-salvar" class="btn-save">SALVAR NO SISTEMA</button>
        <button class="btn-print" onclick="window.print()">IMPRIMIR / PDF</button>
    </div>

    <div id="area-impressao">
        <div class="folha-a4" id="folha-a4">
            <div class="header-top" id="out-empresa">NOME DA EMPRESA</div>
            
            <div class="header-grid">
                <div class="col-esq">
                    <div class="linha-dados">
                        <div class="col" style="flex: 2;"><span class="label-simple">Cliente</span> <span id="out-cliente"></span></div>
                        <div class="col" style="flex: 1; background: #666; color: white; font-weight: bold; -webkit-print-color-adjust: exact; print-color-adjust: exact;"><span style="margin-right: 5px;">Tel:</span> <span id="out-tel" style="font-weight: 400;"></span></div>
                    </div>
                    <div class="linha-dados">
                        <div class="col" style="width: 100%;"><span class="label-simple">Endere√ßo</span> <span id="out-end"></span></div>
                    </div>
                    <div class="grid-datas-pag">
                        <div class="box-pagamento">
                            RESTANTE
                            <span id="out-pag" class="pag-valor">R$ 0,00</span>
                        </div>
                        <div class="box-data">
                            <div class="data-header">Aprova√ß√£o</div>
                            <div class="data-valor" style="color: black;" id="out-data-aprov">00/00</div>
                        </div>
                        <div class="box-data">
                            <div class="data-header" style="background: var(--red);">ENTREGA</div>
                            <div class="data-valor" id="out-data-limite">00/00</div>
                        </div>
                    </div>
                </div>

                <div class="col-dir">
                    <div class="box-os">
                        <span class="os-label">N¬∫ OS</span>
                        <div class="os-valor-box"><span class="os-valor" id="out-os">0000</span></div>
                    </div>
                    <div class="box-logistica">
                        <div class="log-item"><div class="box-check-log" id="x-inst"></div> INSTALA√á√ÉO</div>
                        <div class="log-item"><div class="box-check-log" id="x-ent"></div> ENTREGA</div>
                        <div class="log-item"><div class="box-check-log" id="x-ret"></div> RETIRADA</div>
                    </div>
                </div>
            </div>

            <div class="area-status">
                <div class="badges-wrapper">
                    <div class="badge-box bg-red"><div class="badge-letra">E</div><div class="badge-x" id="x-entrada"></div></div>
                    <div class="badge-box bg-blue"><div class="badge-letra">F</div><div class="badge-x" id="x-faturado" style="color: var(--blue);"></div></div>
                    <div class="badge-box bg-green"><div class="badge-letra">P</div><div class="badge-x" id="x-pago" style="color: var(--green);"></div></div>
                </div>
                <div class="maq-cartao">M√ÅQ. CART√ÉO<div class="box-check-maq" id="x-maq"></div></div>
            </div>
            
            <div class="titulo-servico" id="out-servico">NOME DO SERVI√áO</div>
            
            <div class="area-imagens" id="canvas-imagens">
                <span class="placeholder-text" id="placeholder-text">ARRASTE AS IMAGENS</span>
            </div>
            
            <div class="area-desc-titulo">DESCRI√á√ÉO T√âCNICA / OBSERVA√á√ïES:</div>
            <div class="box-anotacoes" id="out-desc"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBxG9GNxfJxWiw8hpreTeShrG009svRmPI",
            authDomain: "artesynal-os-system.firebaseapp.com",
            projectId: "artesynal-os-system",
            storageBucket: "artesynal-os-system.firebasestorage.app",
            messagingSenderId: "539958005846",
            appId: "1:539958005846:web:9120505e097b56bf16ebf7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function salvarOS() {
            const btn = document.getElementById('btn-salvar');
            btn.innerText = "Salvando...";
            btn.disabled = true;
            try {
                const dados = {
                    empresa: document.getElementById('in-empresa').value,
                    cliente: document.getElementById('in-cliente').value,
                    telefone: document.getElementById('in-tel').value,
                    endereco: document.getElementById('in-end').value,
                    os_numero: document.getElementById('in-os').value,
                    valor_restante: document.getElementById('in-pag').value,
                    data_aprovacao: document.getElementById('in-data-aprov').value,
                    data_limite: document.getElementById('in-data-limite').value,
                    servico_titulo: document.getElementById('in-servico').value,
                    descricao: document.getElementById('in-desc').value,
                    status: {
                        entrada: document.getElementById('chk-entrada').checked,
                        faturado: document.getElementById('chk-faturado').checked,
                        pago: document.getElementById('chk-pago').checked,
                        maquina: document.getElementById('chk-maq').checked
                    },
                    logistica: {
                        instalacao: document.getElementById('chk-inst').checked,
                        entrega: document.getElementById('chk-ent').checked,
                        retirada: document.getElementById('chk-ret').checked
                    },
                    data_criacao: new Date()
                };
                const docRef = await addDoc(collection(db, "ordens_servico"), dados);
                alert("OS Salva com sucesso! ID: " + docRef.id);
                btn.innerText = "SALVAR NO SISTEMA";
                btn.disabled = false;
            } catch (e) {
                console.error("Erro ao salvar: ", e);
                alert("Erro ao salvar.");
                btn.innerText = "ERRO AO SALVAR";
                btn.disabled = false;
            }
        }
        document.getElementById('btn-salvar').addEventListener('click', salvarOS);
    </script>

    <script>
        // --- NAVEGA√á√ÉO MOBILE ---
        function abrirPrevia() {
            document.getElementById('painel-controle').style.display = 'none';
            document.getElementById('area-impressao').style.display = 'flex';
            document.getElementById('btn-abrir-previa').style.display = 'none';
            document.getElementById('btn-fechar-previa').style.display = 'flex';
            document.getElementById('btn-imprimir-mobile').style.display = 'flex';
            
            const folha = document.getElementById('folha-a4');
            const larguraTela = window.innerWidth;
            const escala = (larguraTela - 20) / 794;
            folha.style.transform = `scale(${escala})`;
        }

        function fecharPrevia() {
            document.getElementById('painel-controle').style.display = 'block';
            document.getElementById('area-impressao').style.display = 'none';
            document.getElementById('btn-abrir-previa').style.display = 'flex';
            document.getElementById('btn-fechar-previa').style.display = 'none';
            document.getElementById('btn-imprimir-mobile').style.display = 'none';
            document.getElementById('mobile-zoom-control').style.display = 'none';
        }

        const inputs = document.querySelectorAll('input, textarea');
        inputs.forEach(input => {
            if(input.type !== 'file' && input.type !== 'range') {
                input.addEventListener('input', up); input.addEventListener('change', up);
            }
        });

        function up() {
            const setTxt = (idOut, idIn, def) => { document.getElementById(idOut).innerText = document.getElementById(idIn).value || def || ""; };
            setTxt('out-empresa', 'in-empresa', 'NOME DA EMPRESA'); setTxt('out-cliente', 'in-cliente', '');
            setTxt('out-tel', 'in-tel', ''); setTxt('out-os', 'in-os', '0000'); setTxt('out-end', 'in-end', '');
            setTxt('out-pag', 'in-pag', 'R$ 0,00'); setTxt('out-data-aprov', 'in-data-aprov', '00/00');
            setTxt('out-data-limite', 'in-data-limite', '00/00'); setTxt('out-servico', 'in-servico', 'NOME DO SERVI√áO');
            setTxt('out-desc', 'in-desc', '');

            const setX = (idOut, idIn) => document.getElementById(idOut).innerText = document.getElementById(idIn).checked ? "X" : "";
            setX('x-entrada', 'chk-entrada'); setX('x-faturado', 'chk-faturado'); setX('x-pago', 'chk-pago');
            setX('x-inst', 'chk-inst'); setX('x-ent', 'chk-ent'); setX('x-ret', 'chk-ret'); setX('x-maq', 'chk-maq');
        }

        // --- CANVAS DE IMAGENS ---
        const canvas = document.getElementById('canvas-imagens');
        let draggedImg = null;
        let startX, startY, initialLeft, initialTop;
        let selectedImgForZoom = null;

        window.adicionarImagens = function(event) {
            const files = event.target.files;
            if (!files) return;
            document.getElementById('placeholder-text').style.display = 'none';

            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.classList.add('draggable-img');
                    img.style.left = '50px'; img.style.top = '50px';
                    img.style.width = '150px';
                    
                    img.addEventListener('mousedown', startDragMouse);
                    img.addEventListener('click', selectImage);
                    img.addEventListener('touchstart', startDragTouch, {passive: false});
                    img.addEventListener('dblclick', (e) => e.target.remove());
                    // Zoom com Scroll (PC)
                    img.addEventListener('wheel', resizeImage, { passive: false });
                    
                    canvas.appendChild(img);
                }
                reader.readAsDataURL(file);
            });
        }

        function selectImage(e) {
            e.stopPropagation();
            document.querySelectorAll('.draggable-img').forEach(img => img.classList.remove('img-selected'));
            e.target.classList.add('img-selected');
            
            // S√≥ mostra o slider se for MOBILE (Detecta pela largura)
            if (window.innerWidth <= 768) {
                selectedImgForZoom = e.target;
                const zoomControl = document.getElementById('mobile-zoom-control');
                const slider = document.getElementById('zoom-slider');
                slider.value = parseInt(selectedImgForZoom.style.width);
                zoomControl.style.display = 'block';
            }
        }

        window.aplicarZoomMobile = function(valor) {
            if(selectedImgForZoom) {
                selectedImgForZoom.style.width = valor + 'px';
            }
        }

        // Fun√ß√£o de Zoom com Scroll (PC)
        function resizeImage(e) {
            e.preventDefault();
            const scaleAmount = 20; // Aumentei a velocidade do zoom no scroll
            let currentWidth = this.offsetWidth;
            
            if (e.deltaY < 0) {
                this.style.width = (currentWidth + scaleAmount) + 'px';
            } else {
                if (currentWidth > 50) this.style.width = (currentWidth - scaleAmount) + 'px';
            }
        }

        canvas.addEventListener('click', () => {
             document.querySelectorAll('.draggable-img').forEach(img => img.classList.remove('img-selected'));
             document.getElementById('mobile-zoom-control').style.display = 'none';
        });

        // Mouse Drag
        function startDragMouse(e) {
            e.preventDefault(); draggedImg = e.target; selectImage(e);
            startX = e.clientX; startY = e.clientY;
            initialLeft = draggedImg.offsetLeft; initialTop = draggedImg.offsetTop;
            document.addEventListener('mousemove', dragMouse); document.addEventListener('mouseup', stopDragMouse);
        }
        function dragMouse(e) {
            if (!draggedImg) return;
            draggedImg.style.left = `${initialLeft + (e.clientX - startX)}px`;
            draggedImg.style.top = `${initialTop + (e.clientY - startY)}px`;
        }
        function stopDragMouse() {
            draggedImg = null; document.removeEventListener('mousemove', dragMouse); document.removeEventListener('mouseup', stopDragMouse);
        }

        // Touch Drag
        function startDragTouch(e) {
            if(e.touches.length > 1) return;
            e.preventDefault(); draggedImg = e.target; selectImage(e);
            const touch = e.touches[0];
            startX = touch.clientX; startY = touch.clientY;
            initialLeft = draggedImg.offsetLeft; initialTop = draggedImg.offsetTop;
            document.addEventListener('touchmove', dragTouch, {passive: false}); document.addEventListener('touchend', stopDragTouch);
        }
        function dragTouch(e) {
            if (!draggedImg) return;
            e.preventDefault();
            const touch = e.touches[0];
            draggedImg.style.left = `${initialLeft + (touch.clientX - startX)}px`;
            draggedImg.style.top = `${initialTop + (touch.clientY - startY)}px`;
        }
        function stopDragTouch() {
            draggedImg = null; document.removeEventListener('touchmove', dragTouch); document.removeEventListener('touchend', stopDragTouch);
        }
    </script>
</body>
</html>
