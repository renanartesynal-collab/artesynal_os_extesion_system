<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema OS - Comunicação Visual</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --black: #231f20;
            --red: #ed1c24;
            --blue: #00aeef;
            --green: #00a651;
            --gray: #e6e7e8;
        }

        /* RESET GERAL */
        body { 
            font-family: 'Montserrat', sans-serif; 
            margin: 0; 
            padding: 0;
            background: #333; 
            display: flex;
        }
        
        /* --- PAINEL DE CONTROLE (ESQUERDA) --- */
        #painel-controle { 
            width: 380px; padding: 25px; background: #2c3e50; color: white;
            height: 100vh; overflow-y: auto; box-sizing: border-box; position: fixed;
            border-right: 5px solid #1a252f; z-index: 10;
        }
        
        #painel-controle::-webkit-scrollbar { width: 8px; }
        #painel-controle::-webkit-scrollbar-track { background: #1a252f; }
        #painel-controle::-webkit-scrollbar-thumb { background: #f1c40f; border-radius: 4px; }

        .grupo-input { margin-bottom: 15px; }
        .titulo-secao { color: #f1c40f; font-weight: bold; margin-top: 20px; border-bottom: 1px solid #555; padding-bottom: 5px; margin-bottom: 10px;}
        label { display: block; font-size: 12px; margin-bottom: 5px; color: #bdc3c7; }
        
        input[type="text"], input[type="date"], input[type="number"], select { 
            width: 100%; padding: 8px; border-radius: 4px; border: none; 
            box-sizing: border-box; font-family: 'Montserrat', sans-serif; font-weight: bold;
        }

        textarea {
            width: 100%; padding: 8px; border-radius: 4px; border: none; 
            box-sizing: border-box; font-family: 'Montserrat', sans-serif; 
            height: 80px; resize: none;
        }
        
        /* Sliders de Imagem */
        .range-control { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
        input[type="range"] { flex: 1; cursor: pointer; }

        /* Checkboxes customizados */
        .check-group { display: flex; flex-direction: column; gap: 8px; }
        .check-item { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .check-item input { transform: scale(1.2); }

        /* --- ÁREA DE IMPRESSÃO (DIREITA) --- */
        #area-impressao { 
            margin-left: 380px; 
            display: flex; 
            justify-content: center; 
            padding: 40px;
            width: calc(100% - 380px); 
            background: #555; 
            min-height: 100vh; 
            box-sizing: border-box;
        }
        
        .folha-a4 {
            width: 210mm; 
            height: 296mm; /* Tamanho exato A4 */
            background: white; 
            position: relative; 
            padding: 10mm; /* Margem interna de 1cm */
            box-sizing: border-box;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            display: flex; 
            flex-direction: column;
        }

        /* --- ESTRUTURA DO MODELO --- */
        .header-top { 
            background: var(--black); color: white; padding: 5px 10px; 
            font-weight: 900; font-size: 20px; text-transform: uppercase; 
            -webkit-print-color-adjust: exact; print-color-adjust: exact;
        }
        
        .linha-dados { display: flex; border: 1px solid var(--black); border-top: none; }
        .col { padding: 4px 8px; border-right: 1px solid var(--black); font-size: 12px; display: flex; align-items: center; }
        .col:last-child { border-right: none; }
        
        .label-simple { font-weight: 900; margin-right: 5px; }

        /* Área Intermediária */
        .area-intermediaria { display: flex; border: 1px solid var(--black); border-top: none; height: 35px; }
        
        .box-pagamento { 
            flex: 1.8; display: flex; align-items: center; padding-left: 10px; 
            font-weight: 900; font-size: 14px; background: #eee;
            -webkit-print-color-adjust: exact; print-color-adjust: exact;
        }

        .box-datas { flex: 1.2; display: flex; }
        .data-item { flex: 1; border-left: 1px solid var(--black); display: flex; flex-direction: column; }
        .data-header { 
            background: #555; color: white; font-size: 8px; text-align: center; 
            padding: 2px; font-weight: bold; 
            -webkit-print-color-adjust: exact; print-color-adjust: exact;
        }
        .data-valor { 
            text-align: center; font-weight: 900; color: var(--red); 
            font-size: 12px; display: flex; align-items: center; justify-content: center; height: 100%; 
        }

        /* Status e Logística */
        .area-inferior { display: flex; justify-content: space-between; margin-top: 5px; border-bottom: 2px dotted #ccc; padding-bottom: 5px;}
        
        .badges-wrapper { display: flex; gap: 3px; align-items: center; }
        .badge-box { display: flex; width: 50px; height: 22px; border: 1px solid #ccc; }
        .badge-letra { 
            width: 18px; display: flex; align-items: center; justify-content: center; 
            color: white; font-weight: 900; font-size: 14px; 
            -webkit-print-color-adjust: exact; print-color-adjust: exact;
        }
        .badge-x { flex: 1; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 16px; color: var(--black); background: white; border-left: 1px solid #ccc; }
        
        .bg-red { background: var(--red); border-color: var(--red); }
        .bg-blue { background: var(--blue); border-color: var(--blue); }
        .bg-green { background: var(--green); border-color: var(--green); }

        .maq-cartao { 
            margin-left: 10px; background: var(--red); color: white; 
            font-weight: 900; font-size: 10px; padding: 2px 5px; 
            display: flex; align-items: center; gap: 5px; height: 18px;
            -webkit-print-color-adjust: exact; print-color-adjust: exact;
        }
        .box-check-maq { width: 12px; height: 12px; background: white; border: 1px solid #ccc; color: black; text-align: center; line-height: 12px; font-size: 12px; font-weight: 900;}

        /* Logística */
        .logistica-wrapper { width: 140px; font-size: 10px; font-weight: 900; }
        .logistica-header { 
            background: #555; color: white; text-align: center; padding: 1px; margin-bottom: 2px; 
            -webkit-print-color-adjust: exact; print-color-adjust: exact;
        }
        .log-item { display: flex; align-items: center; margin-bottom: 2px; }
        .box-check-log { width: 10px; height: 10px; border: 1px solid var(--black); margin-right: 5px; display: flex; align-items: center; justify-content: center; font-size: 9px; color: var(--red); line-height: 10px;}

        /* Imagens e Corpo */
        .titulo-servico { text-align: center; color: var(--red); font-weight: 900; font-size: 20px; margin: 10px 0; text-transform: uppercase; }
        
        /* Flex-grow faz a imagem ocupar todo o espaço disponível verticalmente */
        .area-imagens { 
            flex-grow: 1; 
            border: 2px dotted #ccc; display: flex; 
            align-items: center; justify-content: center; 
            position: relative; overflow: hidden; margin-bottom: 10px;
            background-color: #f9f9f9;
        }
        
        #img-preview { position: absolute; transform-origin: center center; }
        .placeholder-text { font-size: 30px; font-weight: 900; color: #e6e7e8; position: absolute; z-index: 0; }

        .area-desc-titulo { font-weight: 900; font-size: 12px; margin-bottom: 2px;}
        .box-anotacoes { 
            height: 100px; border: 1px solid var(--black); 
            padding: 5px; font-size: 12px; font-family: 'Montserrat', sans-serif;
            white-space: pre-wrap; 
        }

        /* Botões */
        .btn-print { width:100%; padding: 15px; background: var(--green); color:white; border:none; font-weight:900; cursor:pointer; border-radius:5px; font-size: 16px; margin-top: 10px; box-shadow: 0 4px 0 #007f3d;}
        .btn-print:hover { background: #008f45; }

        .btn-save { width:100%; padding: 15px; background: var(--blue); color:white; border:none; font-weight:900; cursor:pointer; border-radius:5px; font-size: 16px; margin-top: 20px; box-shadow: 0 4px 0 #007db0;}
        .btn-save:hover { background: #009ad6; }

        /* --- CONFIGURAÇÃO DE IMPRESSÃO (O SEGREDO) --- */
        @page {
            size: A4;
            margin: 0; /* Remove margem branca do navegador */
        }

        @media print {
            body { 
                background: white; 
                margin: 0; 
                padding: 0;
            }
            #painel-controle { display: none; } /* Some com o menu */
            #area-impressao { 
                margin: 0; 
                padding: 0; 
                width: 100%; 
                height: 100vh; /* Força altura total */
                background: none; 
                display: block;
            }
            .folha-a4 { 
                box-shadow: none; 
                padding: 10mm; /* Mantém a margem interna de 1cm */
                margin: 0 auto; 
                width: 210mm; 
                height: 296mm; 
                page-break-after: always; 
                border: none;
            }
            .area-imagens { border: 1px dotted #ccc; }
        }
    </style>
</head>
<body>

    <div id="painel-controle">
        <h2 style="margin-top: 0; color: #f1c40f;">GERADOR DE O.S.</h2>

        <div class="grupo-input">
            <label>NOME DA EMPRESA</label>
            <input type="text" id="in-empresa" placeholder="Ex: Gráfica Rápida" value="SUA EMPRESA AQUI">
        </div>

        <div class="titulo-secao">DADOS DO CLIENTE</div>
        <div class="grupo-input">
            <label>NOME DO CLIENTE</label>
            <input type="text" id="in-cliente">
        </div>
        <div class="grupo-input">
            <label>TELEFONE</label>
            <input type="text" id="in-tel" placeholder="(00) 00000-0000">
        </div>
        <div class="grupo-input">
            <label>ENDEREÇO</label>
            <input type="text" id="in-end">
        </div>

        <div class="titulo-secao">FINANCEIRO & DATAS</div>
        <div style="display: flex; gap: 10px;">
            <div class="grupo-input" style="flex:1;">
                <label>Nº OS</label>
                <input type="text" id="in-os" placeholder="0000">
            </div>
            <div class="grupo-input" style="flex:2;">
                <label>VALOR RESTANTE</label>
                <input type="text" id="in-pag" placeholder="R$ 0,00">
            </div>
        </div>

        <div style="display: flex; gap: 10px;">
            <div class="grupo-input">
                <label>APROVAÇÃO</label>
                <input type="text" id="in-data-aprov" placeholder="00/00">
            </div>
            <div class="grupo-input">
                <label>DATA LIMITE</label>
                <input type="text" id="in-data-limite" placeholder="00/00">
            </div>
        </div>

        <div class="check-group">
            <label class="check-item"><input type="checkbox" id="chk-entrada"> ENTRADA (E)</label>
            <label class="check-item"><input type="checkbox" id="chk-faturado"> FATURADO (F)</label>
            <label class="check-item"><input type="checkbox" id="chk-pago"> PAGO (P)</label>
            <label class="check-item"><input type="checkbox" id="chk-maq"> MÁQUINA DE CARTÃO</label>
        </div>

        <div class="titulo-secao">LOGÍSTICA</div>
        <div class="check-group">
            <label class="check-item"><input type="checkbox" id="chk-inst"> INSTALAÇÃO</label>
            <label class="check-item"><input type="checkbox" id="chk-ent"> ENTREGA</label>
            <label class="check-item"><input type="checkbox" id="chk-ret"> RETIRADA</label>
        </div>

        <div class="titulo-secao">SERVIÇO E IMAGEM</div>
        <div class="grupo-input">
            <label>TÍTULO DO SERVIÇO</label>
            <input type="text" id="in-servico">
        </div>
        
        <div class="grupo-input">
            <label>SELECIONAR IMAGEM</label>
            <input type="file" accept="image/*" onchange="carregarImagem(event)">
        </div>

        <div id="controles-img" style="display:none; background: #34495e; padding: 10px; border-radius: 5px;">
            <label>ZOOM</label>
            <input type="range" id="zoom-img" min="0.1" max="3" step="0.1" value="1" oninput="ajustarImagem()">
            <label>POSIÇÃO X (Lados)</label>
            <input type="range" id="pos-x" min="-300" max="300" value="0" oninput="ajustarImagem()">
            <label>POSIÇÃO Y (Altura)</label>
            <input type="range" id="pos-y" min="-300" max="300" value="0" oninput="ajustarImagem()">
        </div>

        <div class="grupo-input" style="margin-top: 15px;">
            <label>DESCRIÇÃO DO SERVIÇO / OBS</label>
            <textarea id="in-desc" placeholder="Detalhes de material, acabamento..."></textarea>
        </div>

        <button id="btn-salvar" class="btn-save">SALVAR NO SISTEMA</button>
        <button class="btn-print" onclick="window.print()">IMPRIMIR / PDF</button>
        <br><br>
    </div>

    <div id="area-impressao">
        <div class="folha-a4">
            <div class="header-top" id="out-empresa">NOME DA EMPRESA</div>
            <div class="linha-dados">
                <div class="col" style="flex: 2;"><span class="label-simple">Cliente</span> <span id="out-cliente"></span></div>
                <div class="col" style="flex: 1; background: #666; color: white; font-weight: bold; -webkit-print-color-adjust: exact; print-color-adjust: exact;"><span style="margin-right: 5px;">Telefone</span> <span id="out-tel" style="font-weight: 400;"></span></div>
                <div class="col" style="flex: 0.5; justify-content: center; font-weight: 900; font-size: 16px;">OS <span id="out-os" style="margin-left: 10px;">0000</span></div>
            </div>
            <div class="linha-dados">
                <div class="col" style="width: 100%;"><span class="label-simple">Endereço</span> <span id="out-end"></span></div>
            </div>
            <div class="area-intermediaria">
                <div class="box-pagamento">
                    Pagamento Restante: <span id="out-pag" style="margin-left: 5px;">R$ 0,00</span>
                </div>
                <div class="box-datas">
                    <div class="data-item">
                        <div class="data-header">Aprovação Layout</div>
                        <div class="data-valor" style="color: black;" id="out-data-aprov">00/00</div>
                    </div>
                    <div class="data-item">
                        <div class="data-header" style="background: var(--red);">Data LIMITE</div>
                        <div class="data-valor" id="out-data-limite">00/00</div>
                    </div>
                </div>
            </div>
            <div class="area-inferior">
                <div style="display: flex; align-items: center;">
                    <div class="badges-wrapper">
                        <div class="badge-box bg-red">
                            <div class="badge-letra">E</div>
                            <div class="badge-x text-red" id="x-entrada"></div>
                        </div>
                        <div class="badge-box bg-blue">
                            <div class="badge-letra">F</div>
                            <div class="badge-x" style="color: var(--blue);" id="x-faturado"></div>
                        </div>
                        <div class="badge-box bg-green">
                            <div class="badge-letra">P</div>
                            <div class="badge-x" style="color: var(--green);" id="x-pago"></div>
                        </div>
                    </div>
                    <div class="maq-cartao">
                        MAQUINA DE CARTÃO!
                        <div class="box-check-maq" id="x-maq"></div>
                    </div>
                </div>
                <div class="logistica-wrapper">
                    <div class="logistica-header">Logística</div>
                    <div class="log-item">
                        <div class="box-check-log" id="x-inst"></div> INSTALAÇÃO
                    </div>
                    <div class="log-item">
                        <div class="box-check-log" id="x-ent"></div> ENTREGA
                    </div>
                    <div class="log-item">
                        <div class="box-check-log" id="x-ret"></div> RETIRADA
                    </div>
                </div>
            </div>
            <div class="titulo-servico" id="out-servico">NOME DO SERVIÇO</div>
            <div class="area-imagens">
                <span class="placeholder-text" id="placeholder-text">IMAGEM AQUI</span>
                <img id="img-preview" src="" style="display: none;">
            </div>
            <div class="area-desc-titulo">Descrição do serviço:</div>
            <div class="box-anotacoes" id="out-desc"></div>
        </div>
    </div>

    <script type="module">
        // Importa o Firebase via CDN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // CONFIGURAÇÃO DO SEU PROJETO
        const firebaseConfig = {
            apiKey: "AIzaSyBxG9GNxfJxWiw8hpreTeShrG009svRmPI",
            authDomain: "artesynal-os-system.firebaseapp.com",
            projectId: "artesynal-os-system",
            storageBucket: "artesynal-os-system.firebasestorage.app",
            messagingSenderId: "539958005846",
            appId: "1:539958005846:web:9120505e097b56bf16ebf7"
        };

        // Inicia o Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- FUNÇÃO DE SALVAR ---
        async function salvarOS() {
            const btn = document.getElementById('btn-salvar');
            btn.innerText = "Salvando...";
            btn.disabled = true;

            try {
                // Coleta os dados dos campos
                const dados = {
                    empresa: document.getElementById('in-empresa').value,
                    cliente: document.getElementById('in-cliente').value,
                    telefone: document.getElementById('in-tel').value,
                    endereco: document.getElementById('in-end').value,
                    os_numero: document.getElementById('in-os').value,
                    valor_restante: document.getElementById('in-pag').value,
                    data_aprovacao: document.getElementById('in-data-aprov').value,
                    data_limite: document.getElementById('in-data-limite').value,
                    servico_titulo: document.getElementById('in-servico').value,
                    descricao: document.getElementById('in-desc').value,
                    status: {
                        entrada: document.getElementById('chk-entrada').checked,
                        faturado: document.getElementById('chk-faturado').checked,
                        pago: document.getElementById('chk-pago').checked,
                        maquina: document.getElementById('chk-maq').checked
                    },
                    logistica: {
                        instalacao: document.getElementById('chk-inst').checked,
                        entrega: document.getElementById('chk-ent').checked,
                        retirada: document.getElementById('chk-ret').checked
                    },
                    data_criacao: new Date()
                };

                // Envia para o Firebase (Coleção 'ordens_servico')
                const docRef = await addDoc(collection(db, "ordens_servico"), dados);
                
                alert("OS Salva com sucesso! ID: " + docRef.id);
                btn.innerText = "SALVAR NO SISTEMA";
                btn.disabled = false;

            } catch (e) {
                console.error("Erro ao salvar: ", e);
                alert("Erro ao salvar. Verifique se o banco de dados está criado no modo TESTE no console do Firebase.");
                btn.innerText = "ERRO AO SALVAR";
                btn.disabled = false;
            }
        }

        document.getElementById('btn-salvar').addEventListener('click', salvarOS);
    </script>

    <script>
        // Atualização visual em tempo real
        const inputs = document.querySelectorAll('input, textarea');
        inputs.forEach(input => {
            if(input.type !== 'file' && input.type !== 'range') {
                input.addEventListener('input', up);
                input.addEventListener('change', up);
            }
        });

        function up() {
            const setTxt = (idOut, idIn, def) => {
                const val = document.getElementById(idIn).value;
                document.getElementById(idOut).innerText = val || def || "";
            };

            setTxt('out-empresa', 'in-empresa', 'NOME DA EMPRESA');
            setTxt('out-cliente', 'in-cliente', '');
            setTxt('out-tel', 'in-tel', '');
            setTxt('out-os', 'in-os', '0000');
            setTxt('out-end', 'in-end', '');
            setTxt('out-pag', 'in-pag', 'R$ 0,00');
            setTxt('out-data-aprov', 'in-data-aprov', '00/00');
            setTxt('out-data-limite', 'in-data-limite', '00/00');
            setTxt('out-servico', 'in-servico', 'NOME DO SERVIÇO');
            setTxt('out-desc', 'in-desc', '');

            const setX = (idOut, idIn) => document.getElementById(idOut).innerText = document.getElementById(idIn).checked ? "X" : "";
            
            setX('x-entrada', 'chk-entrada');
            setX('x-faturado', 'chk-faturado');
            setX('x-pago', 'chk-pago');
            setX('x-inst', 'chk-inst');
            setX('x-ent', 'chk-ent');
            setX('x-ret', 'chk-ret');
            setX('x-maq', 'chk-maq');
        }

        // --- SISTEMA DE IMAGEM ---
        window.carregarImagem = function(event) {
            const input = event.target;
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e){
                    const img = document.getElementById('img-preview');
                    const placeholder = document.getElementById('placeholder-text');
                    const painelControle = document.getElementById('controles-img');

                    img.src = e.target.result;
                    img.style.display = "block";
                    placeholder.style.display = "none";
                    painelControle.style.display = "block";
                    
                    document.getElementById('zoom-img').value = 1;
                    document.getElementById('pos-x').value = 0;
                    document.getElementById('pos-y').value = 0;
                    window.ajustarImagem();
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        window.ajustarImagem = function() {
            const img = document.getElementById('img-preview');
            const zoom = document.getElementById('zoom-img').value;
            const x = document.getElementById('pos-x').value;
            const y = document.getElementById('pos-y').value;
            img.style.transform = `translate(${x}px, ${y}px) scale(${zoom})`;
        }
    </script>
</body>
</html>
